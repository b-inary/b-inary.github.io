<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="An open-source postflop solver library."><meta name="keywords" content="rust, rustlang, rust-lang, postflop_solver"><title>postflop_solver - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../postflop_solver/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../postflop_solver/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Crate postflop_solver</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.1.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../postflop_solver/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">postflop_solver</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/postflop_solver/lib.rs.html#1-166">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>An open-source postflop solver library.</p>
<h2 id="examples"><a href="#examples">Examples</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>postflop_solver::<span class="kw-2">*</span>;

<span class="comment">// configure game specification
</span><span class="kw">let </span>oop_range = <span class="string">&quot;66+,A8s+,A5s-A4s,AJo+,K9s+,KQo,QTs+,JTs,96s+,85s+,75s+,65s,54s&quot;</span>;
<span class="kw">let </span>ip_range = <span class="string">&quot;QQ-22,AQs-A2s,ATo+,K5s+,KJo+,Q8s+,J8s+,T7s+,96s+,86s+,75s+,64s+,53s+&quot;</span>;
<span class="kw">let </span>bet_sizes = BetSizeCandidates::try_from((<span class="string">&quot;50%&quot;</span>, <span class="string">&quot;50%&quot;</span>)).unwrap();
<span class="kw">let </span>config = GameConfig {
    flop: flop_from_str(<span class="string">&quot;Td9d6h&quot;</span>).unwrap(),
    turn: card_from_str(<span class="string">&quot;Qh&quot;</span>).unwrap(),
    river: NOT_DEALT,
    starting_pot: <span class="number">200</span>,
    effective_stack: <span class="number">900</span>,
    range: [oop_range.parse().unwrap(), ip_range.parse().unwrap()],
    flop_bet_sizes: [bet_sizes.clone(), bet_sizes.clone()],
    turn_bet_sizes: [bet_sizes.clone(), bet_sizes.clone()],
    river_bet_sizes: [bet_sizes.clone(), bet_sizes.clone()],
    add_all_in_threshold: <span class="number">1.2</span>,
    force_all_in_threshold: <span class="number">0.1</span>,
    adjust_last_two_bet_sizes: <span class="bool-val">true</span>,
};

<span class="comment">// build game tree
</span><span class="kw">let </span><span class="kw-2">mut </span>game = PostFlopGame::with_config(<span class="kw-2">&amp;</span>config).unwrap();

<span class="comment">// obtain private hands
</span><span class="kw">let </span>oop_hands = game.private_hand_cards(<span class="number">0</span>);
<span class="macro">println!</span>(
    <span class="string">&quot;oop_hands[0]: {}{}&quot;</span>,
    card_to_string(oop_hands[<span class="number">0</span>].<span class="number">1</span>).unwrap(), <span class="comment">// 5c
    </span>card_to_string(oop_hands[<span class="number">0</span>].<span class="number">0</span>).unwrap()  <span class="comment">// 4c
</span>);

<span class="comment">// check memory usage
</span><span class="kw">let </span>(mem_usage, mem_usage_compressed) = game.memory_usage();
<span class="macro">println!</span>(
    <span class="string">&quot;Memory usage without compression: {:.2}GB&quot;</span>,
    mem_usage <span class="kw">as </span>f64 / (<span class="number">1024.0 </span>* <span class="number">1024.0 </span>* <span class="number">1024.0</span>)
);
<span class="macro">println!</span>(
    <span class="string">&quot;Memory usage with compression: {:.2}GB&quot;</span>,
    mem_usage_compressed <span class="kw">as </span>f64 / (<span class="number">1024.0 </span>* <span class="number">1024.0 </span>* <span class="number">1024.0</span>)
);

<span class="comment">// allocate memory without compression
</span>game.allocate_memory(<span class="bool-val">false</span>);

<span class="comment">// allocate memory with compression
// game.allocate_memory(true);

// solve the game
</span><span class="kw">let </span>max_num_iterations = <span class="number">1000</span>;
<span class="kw">let </span>target_exploitability = config.starting_pot <span class="kw">as </span>f32 * <span class="number">0.005</span>;
<span class="kw">let </span>exploitability = solve(<span class="kw-2">&amp;mut </span>game, max_num_iterations, target_exploitability, <span class="bool-val">true</span>);
<span class="macro">println!</span>(<span class="string">&quot;Exploitability: {:.2}&quot;</span>, exploitability);

<span class="comment">// solve the game manually
// for i in 0..max_num_iterations {
//     solve_step(&amp;game, i);
//     if (i + 1) % 10 == 0 {
//         let exploitability = compute_exploitability(&amp;game);
//         if exploitability &lt;= target_exploitability {
//             println!(&quot;Exploitability: {:.2}&quot;, exploitability);
//             break;
//         }
//     }
// }
// finalize(&amp;mut game);

// get equity and EV of a specific hand
</span>game.cache_normalized_weights();
<span class="kw">let </span>equity = game.equity(game.current_player());
<span class="kw">let </span>ev = game.expected_values();
<span class="macro">println!</span>(<span class="string">&quot;Equity of oop_hands[0]: {:.2}%&quot;</span>, <span class="number">100.0 </span>* equity[<span class="number">0</span>]);
<span class="macro">println!</span>(<span class="string">&quot;EV of oop_hands[0]: {:.2}&quot;</span>, ev[<span class="number">0</span>]);

<span class="comment">// get equity and EV of whole hand
</span><span class="kw">let </span>weights = game.normalized_weights(game.current_player());
<span class="kw">let </span>average_equity = compute_average(<span class="kw-2">&amp;</span>equity, weights);
<span class="kw">let </span>average_ev = compute_average(<span class="kw-2">&amp;</span>ev, weights);
<span class="macro">println!</span>(<span class="string">&quot;Average equity: {:.2}%&quot;</span>, <span class="number">100.0 </span>* average_equity);
<span class="macro">println!</span>(<span class="string">&quot;Average EV: {:.2}&quot;</span>, average_ev);

<span class="comment">// get available actions
</span><span class="kw">let </span>actions = game.available_actions();
<span class="macro">println!</span>(<span class="string">&quot;Available actions: {:?}&quot;</span>, actions); <span class="comment">// [Check, Bet(100)]

// play `Bet(100)`
</span>game.play(<span class="number">1</span>);

<span class="comment">// get available actions
</span><span class="kw">let </span>actions = game.available_actions();
<span class="macro">println!</span>(<span class="string">&quot;Available actions: {:?}&quot;</span>, actions); <span class="comment">// [Fold, Call, Raise(300)]

// play `Call`
</span>game.play(<span class="number">1</span>);

<span class="comment">// confirm that the current node is a chance node
</span><span class="macro">assert!</span>(game.is_chance_node());

<span class="comment">// confirm that &quot;7s&quot; may be dealt
</span><span class="kw">let </span>card = card_from_str(<span class="string">&quot;7s&quot;</span>).unwrap();
<span class="macro">assert!</span>(game.possible_cards() &amp; (<span class="number">1 </span>&lt;&lt; card) != <span class="number">0</span>);

<span class="comment">// deal &quot;7s&quot;
</span>game.play(card <span class="kw">as </span>usize);

<span class="comment">// back to the root node
</span>game.back_to_root();</code></pre></div>
<h2 id="implementation-details"><a href="#implementation-details">Implementation details</a></h2>
<ul>
<li><strong>Algorithm</strong>: The solver uses <a href="https://arxiv.org/abs/1809.04040">Discounted CFR</a> algorithm.
Currently, the value of γ is set to 5.0, rather than the 2.0 recommended by the original paper.</li>
<li><strong>Precision</strong>: 32-bit floating-point numbers are used in most places.
When calculating summations, temporal values use 64-bit floating-point numbers.
If the compression feature is enabled, each game node stores the values by 16-bit integers
with a single 32-bit floating-point scaling factor.</li>
<li><strong>Handling isomorphism</strong>: The solver does not perform any abstraction.
However, isomorphic chances (turn and river deals) are combined into one.
For example, if the flop is monotone, the three non-dealt suits are isomorphic,
allowing us to skip the calculation for two of the three suits.</li>
</ul>
<h2 id="crate-features"><a href="#crate-features">Crate features</a></h2>
<ul>
<li><code>bincode</code>: Uses <a href="https://github.com/bincode-org/bincode">bincode</a> crate (2.0.0-rc.1) to serialize and deserialize the <code>PostFlopGame</code> struct.
Disabled by default.</li>
<li><code>custom-alloc</code>: Uses custom memory allocator in solving process (only available in nightly Rust).
It significantly reduces the number of calls of the default allocator,
so it is recommended to use this feature when the default allocator is not so efficient.
Note that this feature assumes that, at most, only one instance of <code>PostFlopGame</code> is available
when solving in a program.
Disabled by default.</li>
<li><code>rayon</code>: Uses <a href="https://github.com/rayon-rs/rayon">rayon</a> crate for parallelization.
Enabled by default.</li>
</ul>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BetSizeCandidates.html" title="postflop_solver::BetSizeCandidates struct">BetSizeCandidates</a></div><div class="item-right docblock-short"><p>Bet size candidates for the first bet and raise.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.GameConfig.html" title="postflop_solver::GameConfig struct">GameConfig</a></div><div class="item-right docblock-short"><p>A struct for postflop game configuration.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MutexGuardLike.html" title="postflop_solver::MutexGuardLike struct">MutexGuardLike</a></div><div class="item-right docblock-short"><p>Smart pointer like wrapper that is returned when <a href="struct.MutexLike.html" title="MutexLike"><code>MutexLike</code></a> is “locked”.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MutexLike.html" title="postflop_solver::MutexLike struct">MutexLike</a></div><div class="item-right docblock-short"><p>Mutex-like wrapper, but it actually does not perform any locking.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PostFlopGame.html" title="postflop_solver::PostFlopGame struct">PostFlopGame</a></div><div class="item-right docblock-short"><p>A struct representing a postflop game.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PostFlopNode.html" title="postflop_solver::PostFlopNode struct">PostFlopNode</a></div><div class="item-right docblock-short"><p>A struct representing a node in postflop game tree.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Range.html" title="postflop_solver::Range struct">Range</a></div><div class="item-right docblock-short"><p>A struct representing a player’s range.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Action.html" title="postflop_solver::Action enum">Action</a></div><div class="item-right docblock-short"><p>Available actions in a postflop game.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.BetSize.html" title="postflop_solver::BetSize enum">BetSize</a></div><div class="item-right docblock-short"><p>Bet size specification.</p>
</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.NOT_DEALT.html" title="postflop_solver::NOT_DEALT constant">NOT_DEALT</a></div><div class="item-right docblock-short"><p>Constant representing that the card is not yet dealt.</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Game.html" title="postflop_solver::Game trait">Game</a></div><div class="item-right docblock-short"><p>The trait representing a game.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.GameNode.html" title="postflop_solver::GameNode trait">GameNode</a></div><div class="item-right docblock-short"><p>The trait representing a node in game tree.</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.card_from_chars.html" title="postflop_solver::card_from_chars fn">card_from_chars</a></div><div class="item-right docblock-short"><p>Attempts to read the next card from a char iterator.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.card_from_str.html" title="postflop_solver::card_from_str fn">card_from_str</a></div><div class="item-right docblock-short"><p>Attempts to convert a string into a card.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.card_to_string.html" title="postflop_solver::card_to_string fn">card_to_string</a></div><div class="item-right docblock-short"><p>Attempts to convert a card into a string.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.compute_average.html" title="postflop_solver::compute_average fn">compute_average</a></div><div class="item-right docblock-short"><p>Computes the average with given weights.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.compute_exploitability.html" title="postflop_solver::compute_exploitability fn">compute_exploitability</a></div><div class="item-right docblock-short"><p>Computes the exploitability of the current strategy.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.finalize.html" title="postflop_solver::finalize fn">finalize</a></div><div class="item-right docblock-short"><p>Finalizes the solving process.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.flop_from_str.html" title="postflop_solver::flop_from_str fn">flop_from_str</a></div><div class="item-right docblock-short"><p>Attempts to convert an optionally space-separated string into a sorted flop array.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.solve.html" title="postflop_solver::solve fn">solve</a></div><div class="item-right docblock-short"><p>Performs Discounted CFR algorithm until the given number of iterations or exploitability is
satisfied.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.solve_step.html" title="postflop_solver::solve_step fn">solve_step</a></div><div class="item-right docblock-short"><p>Proceeds Discounted CFR algorithm for one iteration.</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="postflop_solver" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0-nightly (801821d15 2022-08-14)" ></div></body></html>